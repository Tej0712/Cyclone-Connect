<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EditEvent.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debug</a> &gt; <a href="index.source.html" class="el_package">com.example.myapplication.Calendar</a> &gt; <span class="el_source">EditEvent.java</span></div><h1>EditEvent.java</h1><pre class="source lang-java linenums">package com.example.myapplication.Calendar;

import android.app.DatePickerDialog;
import android.app.TimePickerDialog;
import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.preference.PreferenceManager;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;

import com.android.volley.Request;
import com.android.volley.Response;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.JsonObjectRequest;
import com.example.myapplication.R;
import com.example.myapplication.helper.VolleySingleton;

import org.json.JSONObject;

import java.time.LocalDate;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;
import java.time.format.FormatStyle;
import java.util.HashMap;
import java.util.Map;

<span class="nc" id="L35">public class EditEvent extends AppCompatActivity {</span>

    private EditText eventNameET, eventDescriptionET;
    private TextView eventDateTV, eventStartTimeTV, eventEndTimeTV;
<span class="nc" id="L39">    private LocalDate selectedDate = LocalDate.now(); // Initialize with the current date to avoid null.</span>
    private LocalTime startTime, endTime;


    @Override
    public void onCreate(@Nullable Bundle savedInstanceState) {
<span class="nc" id="L45">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L46">        setContentView(R.layout.activity_event_edit);</span>

<span class="nc" id="L48">        eventNameET = findViewById(R.id.eventNameET);</span>
<span class="nc" id="L49">        eventDescriptionET = findViewById(R.id.eventDescriptionET);</span>
<span class="nc" id="L50">        eventDateTV = findViewById(R.id.eventDateTV);</span>
<span class="nc" id="L51">        eventStartTimeTV = findViewById(R.id.eventStartTimeTV);</span>
<span class="nc" id="L52">        eventEndTimeTV = findViewById(R.id.eventEndTimeTV);</span>
<span class="nc" id="L53">        Button selectDateButton = findViewById(R.id.selectDateButton);</span>
<span class="nc" id="L54">        Button selectStartTimeButton = findViewById(R.id.selectStartTimeButton);</span>
<span class="nc" id="L55">        Button selectEndTimeButton = findViewById(R.id.selectEndTimeButton);</span>
<span class="nc" id="L56">        Button saveEventButton = findViewById(R.id.saveEventButton);</span>

<span class="nc" id="L58">        selectDateButton.setOnClickListener(v -&gt; selectDate());</span>
<span class="nc" id="L59">        selectStartTimeButton.setOnClickListener(v -&gt; selectTime(true));</span>
<span class="nc" id="L60">        selectEndTimeButton.setOnClickListener(v -&gt; selectTime(false));</span>

<span class="nc" id="L62">        DateTimeFormatter pattern = DateTimeFormatter.ofLocalizedDate(FormatStyle.LONG);</span>
<span class="nc" id="L63">        String formatDate = selectedDate.format(pattern);</span>

<span class="nc" id="L65">        SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(this);</span>
<span class="nc" id="L66">        long userId = sharedPreferences.getLong(&quot;userId&quot;, -1); // Make sure the key matches (&quot;userId&quot; not &quot;UserID&quot;)</span>


<span class="nc" id="L69">        saveEventButton.setOnClickListener(new View.OnClickListener() {</span>

            @Override
            public void onClick(View view) {
<span class="nc" id="L73">                Log.i(&quot;Event Name&quot;, eventNameET.getText().toString());</span>
<span class="nc" id="L74">                Log.i(&quot;Event Description&quot;, eventDescriptionET.getText().toString());</span>
<span class="nc" id="L75">                Log.i(&quot;Date&quot;,selectedDate.toString());</span>
<span class="nc" id="L76">                Log.i(&quot;Start time&quot;, startTime.toString());</span>
<span class="nc" id="L77">                Log.i(&quot;End time&quot;, endTime.toString());</span>



<span class="nc" id="L81">                String sendEventToServerLink = &quot;http://coms-309-046.class.las.iastate.edu:8080/api/user/calendar/&quot;+ userId;</span>
<span class="nc" id="L82">                Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();</span>
<span class="nc" id="L83">                String eventName = eventNameET.getText().toString();</span>
<span class="nc" id="L84">                String description = eventDescriptionET.getText().toString();</span>
<span class="nc" id="L85">                String start = startTime.toString();</span>
<span class="nc" id="L86">                String end = endTime.toString();</span>
<span class="nc" id="L87">                String date = selectedDate.toString();</span>

<span class="nc" id="L89">                params.put(&quot;title&quot;, eventName);</span>
<span class="nc" id="L90">                params.put(&quot;description&quot;, description);</span>
<span class="nc" id="L91">                params.put(&quot;date&quot;, date);</span>
<span class="nc" id="L92">                params.put(&quot;startTime&quot;, start);</span>
<span class="nc" id="L93">                params.put(&quot;endTime&quot;, end);</span>

<span class="nc" id="L95">                JSONObject jsonObject = new JSONObject(params);</span>
<span class="nc" id="L96">                Log.i(&quot;Parameters Passed&quot;, String.valueOf(jsonObject));</span>
<span class="nc" id="L97">                JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(Request.Method.POST, sendEventToServerLink, jsonObject, new Response.Listener&lt;JSONObject&gt;() {</span>
                    @Override
                    public void onResponse(JSONObject response) {
<span class="nc" id="L100">                        Log.i(&quot;Response from Save&quot;, response.toString());</span>
<span class="nc" id="L101">                        Toast.makeText(EditEvent.this, &quot;Event created successfully&quot;, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L102">                        Intent intent = new Intent(EditEvent.this, WeekViewActivity.class);</span>
<span class="nc" id="L103">                        startActivity(intent);</span>
<span class="nc" id="L104">                    }</span>
<span class="nc" id="L105">                }, new Response.ErrorListener() {</span>
                    @Override
                    public void onErrorResponse(VolleyError error) {
<span class="nc" id="L108">                        error.printStackTrace();</span>
<span class="nc" id="L109">                    }</span>
<span class="nc" id="L110">                }) {</span>
                    public Map&lt;String, String&gt; getHeaders() {
<span class="nc" id="L112">                        Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();</span>
<span class="nc" id="L113">                        headers.put(&quot;Content-Type&quot;, &quot;application/json&quot;);</span>
<span class="nc" id="L114">                        return headers;</span>
                    }

                    protected Map&lt;String, String&gt; getParams() {
<span class="nc" id="L118">                        Map&lt;String, String&gt; params = new HashMap&lt;&gt;();</span>
<span class="nc" id="L119">                        return params;</span>
                    }
                };
<span class="nc" id="L122">                VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(jsonObjectRequest);</span>
<span class="nc" id="L123">            }</span>
        });

<span class="nc" id="L126">    }</span>

    private void selectDate() {
<span class="nc" id="L129">        DatePickerDialog datePickerDialog = new DatePickerDialog(this, (view, year, month, dayOfMonth) -&gt; {</span>
<span class="nc" id="L130">            selectedDate = LocalDate.of(year, month + 1, dayOfMonth);</span>
<span class="nc" id="L131">            eventDateTV.setText(&quot;Date: &quot; + selectedDate.format(DateTimeFormatter.ofPattern(&quot;dd MMM yyyy&quot;)));</span>
<span class="nc" id="L132">        }, selectedDate.getYear(), selectedDate.getMonthValue() - 1, selectedDate.getDayOfMonth());</span>
<span class="nc" id="L133">        datePickerDialog.show();</span>
<span class="nc" id="L134">    }</span>

    private void selectTime(boolean isStartTime) {
<span class="nc" id="L137">        TimePickerDialog timePickerDialog = new TimePickerDialog(this, (view, hourOfDay, minute) -&gt; {</span>
<span class="nc" id="L138">            LocalTime time = LocalTime.of(hourOfDay, minute);</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">            if (isStartTime) {</span>
<span class="nc" id="L140">                startTime = time;</span>
<span class="nc" id="L141">                eventStartTimeTV.setText(&quot;Start Time: &quot; + startTime.format(DateTimeFormatter.ofPattern(&quot;HH:mm&quot;)));</span>
            } else {
<span class="nc" id="L143">                endTime = time;</span>
<span class="nc" id="L144">                eventEndTimeTV.setText(&quot;End Time: &quot; + endTime.format(DateTimeFormatter.ofPattern(&quot;HH:mm&quot;)));</span>
            }
<span class="nc" id="L146">        }, 12, 0, true);</span>
<span class="nc" id="L147">        timePickerDialog.show();</span>
<span class="nc" id="L148">    }</span>
}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.0.0</div></body></html>